<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 900">
  <defs>
    <linearGradient id="headerGrad" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#7c3aed;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#a855f7;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="ahGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#dc2626;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#ef4444;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="espGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#059669;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#10b981;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="ikeGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#ea580c;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#f97316;stop-opacity:1" />
    </linearGradient>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <dropShadow dx="2" dy="2" stdDeviation="3" flood-color="#000000" flood-opacity="0.3"/>
    </filter>
  </defs>

  <!-- Background -->
  <rect width="1200" height="900" fill="#f8fafc"/>

  <!-- Header -->
  <rect x="0" y="0" width="1200" height="80" fill="url(#headerGrad)"/>
  <text x="600" y="50" text-anchor="middle" fill="white" font-size="28" font-weight="bold">IPSec Protocol Architecture &amp; Implementation</text>

  <!-- IPSec Architecture Overview -->
  <rect x="50" y="100" width="1100" height="60" fill="#ede9fe" stroke="#7c3aed" stroke-width="2" rx="10"/>
  <text x="600" y="125" text-anchor="middle" fill="#581c87" font-size="18" font-weight="bold">IPSec Architecture Components</text>
  <text x="600" y="145" text-anchor="middle" fill="#374151" font-size="14">Authentication Header (AH) + Encapsulating Security Payload (ESP) + Internet Key Exchange (IKE)</text>

  <!-- AH Protocol -->
  <rect x="50" y="180" width="350" height="300" fill="#fef2f2" stroke="#dc2626" stroke-width="2" rx="10" filter="url(#shadow)"/>
  <rect x="60" y="190" width="330" height="40" fill="url(#ahGrad)" rx="8"/>
  <text x="225" y="215" text-anchor="middle" fill="white" font-size="18" font-weight="bold">Authentication Header (AH)</text>

  <text x="70" y="250" fill="#7f1d1d" font-size="14" font-weight="bold">Purpose:</text>
  <text x="70" y="270" fill="#374151" font-size="12">• Data integrity verification</text>
  <text x="70" y="285" fill="#374151" font-size="12">• Authentication of IP packets</text>
  <text x="70" y="300" fill="#374151" font-size="12">• Anti-replay protection</text>

  <text x="70" y="330" fill="#7f1d1d" font-size="14" font-weight="bold">AH Header Format:</text>
  <text x="70" y="350" fill="#374151" font-size="12">• Next Header (8 bits)</text>
  <text x="70" y="365" fill="#374151" font-size="12">• Payload Length (8 bits)</text>
  <text x="70" y="380" fill="#374151" font-size="12">• Reserved (16 bits)</text>
  <text x="70" y="395" fill="#374151" font-size="12">• Security Parameter Index (32 bits)</text>
  <text x="70" y="410" fill="#374151" font-size="12">• Sequence Number (32 bits)</text>
  <text x="70" y="425" fill="#374151" font-size="12">• Authentication Data (variable)</text>

  <text x="70" y="455" fill="#7f1d1d" font-size="14" font-weight="bold">Limitations:</text>
  <text x="70" y="470" fill="#374151" font-size="12">• No encryption (data confidentiality)</text>

  <!-- ESP Protocol -->
  <rect x="420" y="180" width="350" height="300" fill="#ecfdf5" stroke="#10b981" stroke-width="2" rx="10" filter="url(#shadow)"/>
  <rect x="430" y="190" width="330" height="40" fill="url(#espGrad)" rx="8"/>
  <text x="595" y="215" text-anchor="middle" fill="white" font-size="18" font-weight="bold">Encapsulating Security Payload (ESP)</text>

  <text x="440" y="250" fill="#065f46" font-size="14" font-weight="bold">Purpose:</text>
  <text x="440" y="270" fill="#374151" font-size="12">• Data confidentiality (encryption)</text>
  <text x="440" y="285" fill="#374151" font-size="12">• Data integrity &amp; authentication</text>
  <text x="440" y="300" fill="#374151" font-size="12">• Anti-replay protection</text>

  <text x="440" y="330" fill="#065f46" font-size="14" font-weight="bold">ESP Header Format:</text>
  <text x="440" y="350" fill="#374151" font-size="12">• Security Parameter Index (32 bits)</text>
  <text x="440" y="365" fill="#374151" font-size="12">• Sequence Number (32 bits)</text>
  <text x="440" y="380" fill="#374151" font-size="12">• Payload Data (variable, encrypted)</text>
  <text x="440" y="395" fill="#374151" font-size="12">• Padding (0-255 bytes)</text>
  <text x="440" y="410" fill="#374151" font-size="12">• Pad Length (8 bits)</text>
  <text x="440" y="425" fill="#374151" font-size="12">• Next Header (8 bits)</text>
  <text x="440" y="440" fill="#374151" font-size="12">• Authentication Data (variable)</text>

  <text x="440" y="470" fill="#065f46" font-size="14" font-weight="bold">Advantages:</text>
  <text x="440" y="485" fill="#374151" font-size="12">• Complete security solution</text>

  <!-- IKE Protocol -->
  <rect x="790" y="180" width="360" height="300" fill="#fff7ed" stroke="#f97316" stroke-width="2" rx="10" filter="url(#shadow)"/>
  <rect x="800" y="190" width="340" height="40" fill="url(#ikeGrad)" rx="8"/>
  <text x="970" y="215" text-anchor="middle" fill="white" font-size="18" font-weight="bold">Internet Key Exchange (IKE)</text>

  <text x="810" y="250" fill="#9a3412" font-size="14" font-weight="bold">Purpose:</text>
  <text x="810" y="270" fill="#374151" font-size="12">• Automatic key management</text>
  <text x="810" y="285" fill="#374151" font-size="12">• SA (Security Association) establishment</text>
  <text x="810" y="300" fill="#374151" font-size="12">• Mutual authentication</text>

  <text x="810" y="330" fill="#9a3412" font-size="14" font-weight="bold">IKE Phases:</text>
  <text x="810" y="350" fill="#374151" font-size="12">Phase 1: Main Mode</text>
  <text x="810" y="365" fill="#374151" font-size="12">• Establish IKE SA</text>
  <text x="810" y="380" fill="#374151" font-size="12">• Identity protection</text>
  <text x="810" y="395" fill="#374151" font-size="12">• Authentication methods</text>

  <text x="810" y="415" fill="#374151" font-size="12">Phase 2: Quick Mode</text>
  <text x="810" y="430" fill="#374151" font-size="12">• Establish IPSec SA</text>
  <text x="810" y="445" fill="#374151" font-size="12">• Key derivation</text>
  <text x="810" y="460" fill="#374151" font-size="12">• Perfect Forward Secrecy</text>

  <!-- IPSec Modes -->
  <rect x="50" y="500" width="530" height="200" fill="#f0f9ff" stroke="#0ea5e9" stroke-width="2" rx="10" filter="url(#shadow)"/>
  <rect x="60" y="510" width="510" height="40" fill="#0ea5e9" rx="8"/>
  <text x="315" y="535" text-anchor="middle" fill="white" font-size="18" font-weight="bold">IPSec Operation Modes</text>

  <!-- Transport Mode -->
  <rect x="70" y="560" width="240" height="130" fill="#e0f2fe" stroke="#0284c7" stroke-width="1" rx="8"/>
  <text x="190" y="580" text-anchor="middle" fill="#0c4a6e" font-size="16" font-weight="bold">Transport Mode</text>
  <text x="80" y="605" fill="#374151" font-size="12">Original IP Packet:</text>
  <rect x="80" y="615" width="40" height="20" fill="#fbbf24" stroke="#f59e0b"/>
  <text x="100" y="628" text-anchor="middle" fill="#000" font-size="10">IP</text>
  <rect x="120" y="615" width="40" height="20" fill="#34d399" stroke="#10b981"/>
  <text x="140" y="628" text-anchor="middle" fill="#000" font-size="10">Data</text>

  <text x="80" y="650" fill="#374151" font-size="12">With IPSec (ESP):</text>
  <rect x="80" y="660" width="40" height="20" fill="#fbbf24" stroke="#f59e0b"/>
  <text x="100" y="673" text-anchor="middle" fill="#000" font-size="10">IP</text>
  <rect x="120" y="660" width="40" height="20" fill="#f87171" stroke="#ef4444"/>
  <text x="140" y="673" text-anchor="middle" fill="#000" font-size="10">ESP</text>
  <rect x="160" y="660" width="40" height="20" fill="#34d399" stroke="#10b981"/>
  <text x="180" y="673" text-anchor="middle" fill="#000" font-size="10">Data</text>

  <!-- Tunnel Mode -->
  <rect x="320" y="560" width="240" height="130" fill="#fef7ff" stroke="#c084fc" stroke-width="1" rx="8"/>
  <text x="440" y="580" text-anchor="middle" fill="#6b21a8" font-size="16" font-weight="bold">Tunnel Mode</text>
  <text x="330" y="605" fill="#374151" font-size="12">Original IP Packet:</text>
  <rect x="330" y="615" width="40" height="20" fill="#fbbf24" stroke="#f59e0b"/>
  <text x="350" y="628" text-anchor="middle" fill="#000" font-size="10">IP</text>
  <rect x="370" y="615" width="40" height="20" fill="#34d399" stroke="#10b981"/>
  <text x="390" y="628" text-anchor="middle" fill="#000" font-size="10">Data</text>

  <text x="330" y="650" fill="#374151" font-size="12">With IPSec (ESP):</text>
  <rect x="330" y="660" width="30" height="20" fill="#60a5fa" stroke="#3b82f6"/>
  <text x="345" y="673" text-anchor="middle" fill="#000" font-size="9">New IP</text>
  <rect x="360" y="660" width="30" height="20" fill="#f87171" stroke="#ef4444"/>
  <text x="375" y="673" text-anchor="middle" fill="#000" font-size="9">ESP</text>
  <rect x="390" y="660" width="30" height="20" fill="#fbbf24" stroke="#f59e0b"/>
  <text x="405" y="673" text-anchor="middle" fill="#000" font-size="9">IP</text>
  <rect x="420" y="660" width="30" height="20" fill="#34d399" stroke="#10b981"/>
  <text x="435" y="673" text-anchor="middle" fill="#000" font-size="9">Data</text>

  <!-- Security Features -->
  <rect x="600" y="500" width="550" height="200" fill="#fefce8" stroke="#eab308" stroke-width="2" rx="10" filter="url(#shadow)"/>
  <rect x="610" y="510" width="530" height="40" fill="#eab308" rx="8"/>
  <text x="875" y="535" text-anchor="middle" fill="white" font-size="18" font-weight="bold">IPSec Security Features</text>

  <text x="620" y="570" fill="#713f12" font-size="14" font-weight="bold">Authentication Algorithms:</text>
  <text x="620" y="590" fill="#374151" font-size="12">• HMAC-MD5, HMAC-SHA1, HMAC-SHA256</text>
  <text x="620" y="605" fill="#374151" font-size="12">• Digital signatures (RSA, DSS)</text>

  <text x="620" y="630" fill="#713f12" font-size="14" font-weight="bold">Encryption Algorithms:</text>
  <text x="620" y="650" fill="#374151" font-size="12">• DES, 3DES, AES (128/192/256-bit)</text>
  <text x="620" y="665" fill="#374151" font-size="12">• Blowfish, CAST</text>

  <text x="620" y="690" fill="#713f12" font-size="14" font-weight="bold">Key Management:</text>
  <text x="620" y="710" fill="#374151" font-size="12">• Manual key distribution</text>
  <text x="620" y="725" fill="#374151" font-size="12">• Automatic key management (IKE/ISAKMP)</text>

  <!-- Implementation Notes -->
  <rect x="50" y="720" width="1100" height="70" fill="#f3f4f6" stroke="#6b7280" stroke-width="1" rx="8"/>
  <text x="70" y="740" fill="#374151" font-size="14" font-weight="bold">Implementation Considerations:</text>
  <text x="70" y="760" fill="#374151" font-size="12">• Performance impact: Encryption/decryption overhead, increased packet size, processing delay</text>
  <text x="70" y="775" fill="#374151" font-size="12">• NAT traversal issues: ESP encryption can break NAT functionality, use NAT-T (NAT Traversal) for IPSec through NAT devices</text>

  <rect x="400" y="810" width="400" height="40" fill="#ddd6fe" stroke="#8b5cf6" stroke-width="2" rx="20"/>
  <text x="600" y="835" text-anchor="middle" fill="#5b21b6" font-size="16" font-weight="bold">Complete Network Layer Security Solution</text>
</svg>